# PNJL 各向异性模型 Omega 函数公式文档

## 物理背景

PNJL各向异性模型是研究强子物质在各向异性条件下相变行为的重要理论框架。该模型结合了：
- **Nambu-Jona-Lasinio (NJL)模型**：描述手征对称性破缺
- **Polyakov Loop**：描述色禁闭的有效自由度
- **各向异性参数 ξ**：描述系统在不同方向上的非均匀性

## 核心 Omega 函数

### 总热力学势

总的热力学势由以下部分组成：

```
Ω_total = Ω_chiral + Ω_thermal + Ω_U
```

### 1. 手征贡献 (Ω_chiral)

```
Ω_chiral = 2G_f Σᵢ φᵢ² - 4K_f φ_u φ_d φ_s
```

其中：
- `φᵢ` (i = u,d,s) 是三种夸克味的手征凝聚
- `G_f` 是四费米子相互作用强度
- `K_f` 是六费米子相互作用强度

### 2. 热力学贡献 (Ω_thermal)

各向异性情况下的热力学势：

```
Ω_thermal = -T ∫₀^Λf d³p/(2π)³ ∫₀¹ dt Σᵢ ln[1 + L₁e^{-(E_i - μᵢ)/T} + L₂e^{-2(E_i - μᵢ)/T}]
```

其中：
- **动量积分范围**：p ∈ [0, Λf]，Λf 为紫外截止
- **角度积分变量**：t = cosθ ∈ [0,1]
- **各向异性能量**：`E_i = √(mᵢ² + p²[ξ²t² + (1-t²)])`
- **Polyakov Loop 变量**：
  - `L₁ = Φ₁ + Φ₂`
  - `L₂ = Φ₁Φ₂`
- `μᵢ` 是第 i 种夸克的化学势
- `T` 是温度

### 3. Polyakov 势能贡献 (Ω_U)

```
Ω_U = T⁴[-½Tₐ Φ₁Φ₂ + T_b ln(1 - 6Φ₁Φ₂ + 4(Φ₁³ + Φ₂³) - 3(Φ₁Φ₂)²)]
```

其中：
- `Tₐ = a₀ + a₁(T₀/T) + a₂(T₀/T)²`
- `T_b = b₃(T₀/T)³`
- `T₀` 是临界温度参数

### 4. 有效质量方程

有效质量由自洽条件确定：

```
mᵢ = m₀ᵢ - 4G_f φᵢ + 2K_f φⱼφₖ  (i≠j≠k)
```

具体为：
- `m_u = m₀_q - 4G_f φ_u + 2K_f φ_d φ_s`
- `m_d = m₀_q - 4G_f φ_d + 2K_f φ_u φ_s`  
- `m_s = m₀_s - 4G_f φ_s + 2K_f φ_u φ_d`

## 数值积分实现

### 被积函数定义

根据上述公式，主要的被积函数为：

```julia
# 热力学对数项
f_thermal(p, t, i) = ln(1 + L₁*exp(-(E_i - μᵢ)/T) + L₂*exp(-2(E_i - μᵢ)/T))

# 各向异性能量
E_i(p, t) = √(mᵢ² + p²(ξ²t² + (1-t²)))

# 积分权重 (球坐标)
weight = p² / π²
```

### 积分接口调用

使用统一积分接口：

```julia
# 2D积分：动量和角度
result = integrate_2d(method, p_nodes, p_weights, t_nodes, t_weights, integrand)

# 其中 integrand = f_thermal * weight
```

## 物理量计算

### 压力

```
P = -∂Ω/∂V = -Ω  (在均匀系统中)
```

### 夸克数密度

```
nᵢ = -∂Ω/∂μᵢ
```

### 手征凝聚

```
⟨q̄q⟩ᵢ = -∂Ω/∂m₀ᵢ = φᵢ
```

### 各向异性参数的作用

当 ξ ≠ 1 时：
- ξ > 1：z方向拉伸（prolate）
- ξ < 1：z方向压缩（oblate）  
- ξ = 1：各向同性情况

## 数值稳定性注意事项

1. **对数函数**：使用 `safe_log` 避免负值或零值
2. **指数函数**：注意大指数时的溢出
3. **积分收敛**：合理选择截止参数和积分精度
4. **自洽求解**：使用稳定的数值求根方法

这些公式为 `calculate_pressure_aniso()` 等函数的实现提供了物理基础。
